
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roundoff Error Amplification &#8212; Scientific Computing</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom_layouts.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pdf_print.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/save_state.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://mejk.github.io/SciComp/class/ErrorsModule/RoundoffAmplification.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Forward and Backwards Errors" href="BackwardForwardConditioning.html" />
    <link rel="prev" title="Horner’s algorithm" href="HornersAlgorithm.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-scicomp.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Scientific Computing</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/syllabus.html">
   Scientific Computing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Prerequisites and installations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../PreReq/software_1.html">
   Module: Installation of necessary software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../PreReq/install-wsl.html">
   Installation of tools: WSL2/Linux etc.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Linux basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../LinuxBasics/Linux-basics.html">
   Linux - the basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LinuxBasics/linux-basic-commands-2.html">
   Linux: Some basic &amp; useful commands
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Python and Jupyter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../PythonBasics/python-installation.html">
   Installation of Python and Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../PythonBasics/python-virtual-environment.html">
   Python virtual environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../PythonBasics/jupyter-intro.html">
   Jupyter Notebook / Jupyter Lab
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Other software
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../OtherSoftware/editing-ascii.html">
   Editing ASCII files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../OtherSoftware/vi-editor.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     vi
    </span>
   </code>
   editor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../OtherSoftware/helpful-software.html">
   Helpful software
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../OtherSoftware/command-line-skill-check.html">
   Test your skills: Command line
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Python &amp; programming
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../PythonBasics/coding-notes-general.html">
   On computation and codes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../PythonBasics/python-intro.html">
   Brief introduction to Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Intro to Scientific computing &amp; HPC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../IntroSciHPC/intro-to-modeling.html">
   Introduction to scientific computing &amp; computational modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../IntroSciHPC/hpc-intro.html">
   Background on computers, computing and High Performance Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../IntroSciHPC/simulation-general.html">
   General aspects of modeling and computer simulations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Random numbers
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../RandomNumbers/random_numbers.html">
   Random numbers
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Errors in Scientific Computing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Errors_summary.html">
   Numerical Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Error_sources.html">
   Sources of Errors in Scientific Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TaylorExample.html">
   Truncation Error in Taylor’s series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FinitePrecision.html">
   Finite Precision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="HornersAlgorithm.html">
   Horner’s algorithm
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Roundoff Error Amplification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BackwardForwardConditioning.html">
   Forward and Backwards Errors
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Interpolation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/InterpFit_summary.html">
   Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/LagrangeForm.html">
   Lagrange Form of the Interpolation Polynomial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/BarycentricInterp.html">
   Barycentric Lagrange Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/InterpErrors.html">
   Interpolation Errors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/Chebyshev.html">
   Chebyshev Polynomials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../InterpFit/Splines.html">
   Splines
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MODULE: Numerical Differentiation &amp; Integration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NDiffInt/NumDiffInt.html">
   Numerical Differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NDiffInt/NumDiffInt_Errors.html">
   Errors in Numerical Differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NDiffInt/Int.html">
   Numerical Integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NDiffInt/HigherOrderInt.html">
   Higher Order Integration Schemes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NDiffInt/GaussianInt.html">
   Gaussian Integration
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  More on computers / helps
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/mejk/computer-stuff">
   Random notes on computers, installation, dual boot, vnc, etc.
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/class/ErrorsModule/RoundoffAmplification.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-adding-numbers-of-very-different-magnitude">
   Example:  Adding numbers of very different magnitude
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Example:  Adding numbers of very different magnitude.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-subtractive-cancellation">
   Example: Subtractive cancellation.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-division-by-a-small-number-and-subtractive-cancellation">
   Example: Division by a small number and Subtractive cancellation.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Example: Subtractive cancellation.
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Roundoff Error Amplification</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-adding-numbers-of-very-different-magnitude">
   Example:  Adding numbers of very different magnitude
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Example:  Adding numbers of very different magnitude.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-subtractive-cancellation">
   Example: Subtractive cancellation.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-division-by-a-small-number-and-subtractive-cancellation">
   Example: Division by a small number and Subtractive cancellation.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Example: Subtractive cancellation.
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="roundoff-error-amplification">
<h1>Roundoff Error Amplification<a class="headerlink" href="#roundoff-error-amplification" title="Permalink to this headline">¶</a></h1>
<p>In addition to accumulation with each floating point operation, roundoff errors can be magnified by</p>
<ol class="simple">
<li><p>Multiplication by a large number or division by a small number.</p></li>
<li><p>Adding numbers of very different magnitude.</p></li>
<li><p>Subtractive cancellation (subtraction of numbers of similar magnitude).</p></li>
</ol>
<p>If we can possibly do something to avoid these magnification events or mitigate their effects it is usually worthwhile.  The issue with how multiplication by a large number or division by a small number can turn a small error into a large one should be fairly clear.  To illustrate the other ideas, we will look at a number of examples.</p>
<div class="section" id="example-adding-numbers-of-very-different-magnitude">
<h2>Example:  Adding numbers of very different magnitude<a class="headerlink" href="#example-adding-numbers-of-very-different-magnitude" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to do a simulation of ocean waves.  Before you start, you have a couple of very basic decisions to make: (1) what units should you use and (2) where to place the origin (the zero).  Possible units could be miles, feet, kilometers, meters, or millimeters.  Hopefully you have enough science background to realize you should avoid miles and feet (NASA’s <a class="reference external" href="https://en.wikipedia.org/wiki/Mars_Climate_Orbiter">Mars climate orbiter</a> is a clear example of why to avoid imperial units).  The remaining choices may seem to be arbitrary.  However, let’s assume you plan on storing the height of the ocean surface using 32-bit floating point numbers.  Conceptually, suppose you decide it makes sense for these “heights” to always be positive so the origin should be at the bottom of the ocean, which at its deepest point is about 11 km below sea level.  If you decide to use units of meters, then most of your numbers of ocean height will then be around 11 000 m.  Suppose, in your simulation, wind starts a wave of initial height 1 mm (you have to start somewhere) which is easily measured in reality.  However, 1 mm = 0.001 m and if your code then has to execute <span class="math notranslate nohighlight">\( 11 000.000 + 0.001\)</span> you will get back <span class="math notranslate nohighlight">\(11 000.00\)</span> (i.e. there will be no change) because there are only about 6 digits of precision with 32-bit floating point numbers and this calculation would require at least 8 to be performed without roundoff.  If instead, you accepted both positive and negative heights for your ocean surface and measured the ocean surface height from sea level, then most of your heights will be around 0 m.  A  change of 1 mm is now easily accommodated without being affected by roundoff errors as <span class="math notranslate nohighlight">\(0.000+0.001\)</span> will now give <span class="math notranslate nohighlight">\(0.001\)</span> with no loss in precision from roundoff at the seventh digit.  Here, you will note I have chosen the unit meters rather than mm or km.  Why is this the better choice?  In this case, waves are typically of the order of meters so this choice makes our heights of order 1 in magnitude.  As indicated, the real world measurements would typically have a resolution of 1 mm = 0.001 m so mm would not be a terrible choice here either.  However, km would not be a good choice as our heights would then be of order 0.001 and our resolution would be 0.000001.  Typing numbers in your code with a bunch of zeros or requiring explicitly filled in exponents is introducing a lot of opportunities for typos that may be very difficult to debug later.  In summary, pick units and an origin so that floating point numbers are, on average, of order one as much as possible.  This reduces both possibilities of roundoff errors and typos that might be hard to find.</p>
</div>
<div class="section" id="id1">
<h2>Example:  Adding numbers of very different magnitude.<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to sum the series</p>
<div class="math notranslate nohighlight">
\[\sum_{n=1}^\infty \frac{1}{n^2}\]</div>
<p>to as high an accuracy as possible.  The exact answer here is <span class="math notranslate nohighlight">\(\pi^2/6 \approx 1.64493\)</span>.  Again, let’s assume we are storing intermediate results of our sum using 32-bit floating point arithmetic so again have only 6 decimal digits or precision.  Obviously you cannot sum an infinite number of terms so you decide to cut it off at 1 million terms, i.e. evaluate</p>
<div class="math notranslate nohighlight">
\[\sum_{n=1}^{10^6} \frac{1}{n^2}.\]</div>
<p>The conventional way to evaluate this would be in order (so <span class="math notranslate nohighlight">\(1+1/2^2+1/3^2+...+1/(10^6)^2\)</span>).  If you do this you will get the result <span class="math notranslate nohighlight">\(1.64393\)</span>, so an absolute error of <span class="math notranslate nohighlight">\(0.001\)</span>.  This is much less than the roundoff error in a single computation so you might think there is nothing you can do about this.   However, if you evaluate the sum in <em>reverse</em> order (i.e. <span class="math notranslate nohighlight">\(1/(10^6)^2 + ...+ 1/3^3 + 1/2^2 +1\)</span>) you will get an answer close to the machine epsilon from the “exact” answer of <span class="math notranslate nohighlight">\(1.64493\)</span>.  Why does this occur?  It turns out that if you sum the terms in order, roundoff errors mean that every term past <span class="math notranslate nohighlight">\(n=1000\)</span> will end up contributing nothing to the sum.  This is again because the term we want to add, <span class="math notranslate nohighlight">\(1/1000^2 = 0.000001\)</span>, is being added to a number <span class="math notranslate nohighlight">\(1.64393\)</span> and the difference in magnitude of these numbers cannot be accommodated with the 6 digits of decimal precision we have with 32-bit floats.  However, when we sum the terms in reverse we only ever add terms of similar magnitude and this gives the very small later terms a chance to add together to build a larger number as we get to the point where we are adding the larger terms.</p>
</div>
<div class="section" id="example-subtractive-cancellation">
<h2>Example: Subtractive cancellation.<a class="headerlink" href="#example-subtractive-cancellation" title="Permalink to this headline">¶</a></h2>
<p>Subtractive cancellation is the converse problem to adding numbers of very different magnitude.  For example, suppose in Example 1 above we  had decided to use the bottom of the ocean as our origin so that our ocean height numbers were typically around 11 000.  Now we are were interested in computing the slope of the ocean surface at neighboring points where the actual difference in height is zero.  However, perhaps due to previous roundoff errors, one measurement is 11 000.02 m and the other is 10999.99 m.  The difference between these two values is 0.03 m = 3cm, much bigger than our desired resolution of mm, and even large if we assumed a resolution of 1 cm.  The solution in this case is again to use a sensible origin such as the average sea level so that the roundoff errors will be of the order of <span class="math notranslate nohighlight">\(10^{-6}\)</span>m so that any differences due to roundoff will be below our 1 mm resolution.</p>
</div>
<div class="section" id="example-division-by-a-small-number-and-subtractive-cancellation">
<h2>Example: Division by a small number and Subtractive cancellation.<a class="headerlink" href="#example-division-by-a-small-number-and-subtractive-cancellation" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to compute</p>
<div class="math notranslate nohighlight">
\[f(x) = \frac{1-\cos x}{\sin x}.\]</div>
<p>and we will assume <span class="math notranslate nohighlight">\(x\in [0,2\pi]\)</span>.  When <span class="math notranslate nohighlight">\(x\)</span> is small this formula suffers from two issues that can magnify roundoff errors: division by a small number (<span class="math notranslate nohighlight">\(\sin x \approx 0\)</span> when <span class="math notranslate nohighlight">\(x\)</span> is small) and subtractive cancellation (<span class="math notranslate nohighlight">\(\cos x \approx 1\)</span> when <span class="math notranslate nohighlight">\(x\)</span> is small).  A simple mathematical transformation that often allows you to eliminate subtractive cancellation is to multiply by the sum of the two terms in question in both a numerator and denominator of a fraction (so effectively multiplying by one) and then rearranging the terms to eliminate the subtraction:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
f(x) &amp; = \frac{1-\cos x}{\sin x} \times \frac{1+\cos x}{1+\cos x}&amp;\\
&amp; = \frac{1-\cos^2 x}{(1+\cos x)\sin x}&amp;\\
&amp; = \frac{\sin x}{1+\cos x},
\end{align}\end{split}\]</div>
<p>where we have used the trig identity <span class="math notranslate nohighlight">\(1-\cos^2 x = \sin^2 x\)</span> to get the final result.  The resulting formula is mathematically equivalent to the original but no longer has either the division by a small number of the subtractive cancellation near <span class="math notranslate nohighlight">\(x=0\)</span>.  However, this formula <em>will</em> have issues near <span class="math notranslate nohighlight">\(x=\pi\)</span> as <span class="math notranslate nohighlight">\(\cos x \approx -1\)</span> near <span class="math notranslate nohighlight">\(x=\pi\)</span> which will again lead to subtractive cancellation and division by the resulting small number.  To solve both these issues one should first test <span class="math notranslate nohighlight">\(x\)</span> to decide if it is closer to <span class="math notranslate nohighlight">\(0\)</span> or <span class="math notranslate nohighlight">\(\pi\)</span> and then pick either the modified formula (when <span class="math notranslate nohighlight">\(x\)</span> is closer to zero) or the original (when <span class="math notranslate nohighlight">\(x\)</span> is closer to <span class="math notranslate nohighlight">\(\pi\)</span>).</p>
</div>
<div class="section" id="id2">
<h2>Example: Subtractive cancellation.<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Recall that the roots of <span class="math notranslate nohighlight">\(ax^2 + bx + c=0\)</span> are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
x_1 &amp;= \frac{-b + \sqrt{b^2-4ac}}{2a},&amp;\\
x_2 &amp;= \frac{-b - \sqrt{b^2-4ac}}{2a}.
\end{align}
\end{split}\]</div>
<p>Note that if <span class="math notranslate nohighlight">\(b^2 \gg 4ac\)</span> then <span class="math notranslate nohighlight">\(\sqrt{b^2-4ac} \approx |b|\)</span> so</p>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(b&gt;0\)</span> then <span class="math notranslate nohighlight">\(x_1\)</span> involves subtraction of similar numbers (<span class="math notranslate nohighlight">\(x_2\)</span> is fine though),</p></li>
<li><p>if <span class="math notranslate nohighlight">\(b&lt;0\)</span> then <span class="math notranslate nohighlight">\(x_2\)</span> involves subtraction of similar numbers (<span class="math notranslate nohighlight">\(x_1\)</span> is fine though).</p></li>
</ul>
<p>If we again apply the trick of multiplying by a fraction where denominator and numerator are both the sum of the terms in question we get for the <span class="math notranslate nohighlight">\(b&gt;0\)</span> case where we need to rewrite <span class="math notranslate nohighlight">\(x_1\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
x_1 &amp;= \frac{-b + \sqrt{b^2-4ac}}{2a} \frac{-b - \sqrt{b^2-4ac}}{-b - \sqrt{b^2-4ac}},&amp;\\
&amp;= \frac{-2c}{b + \sqrt{b^2-4ac}}.
\end{align}
\end{split}\]</div>
<p>where a small amount of algebra is used to simplify the final expression which no longer has the problem of subtracting similar numbers.  Note that you should only use this formula for <span class="math notranslate nohighlight">\(x_1\)</span> when <span class="math notranslate nohighlight">\(b&gt;0\)</span>.  When <span class="math notranslate nohighlight">\(b&lt;0\)</span> you should use the original formula for <span class="math notranslate nohighlight">\(x_1\)</span> and apply a similar transformation for <span class="math notranslate nohighlight">\(x_2\)</span> instead.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "mejk/SciComp_template",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./class/ErrorsModule"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="HornersAlgorithm.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Horner’s algorithm</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="BackwardForwardConditioning.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Forward and Backwards Errors</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Mikko Karttunen and Colin Denniston<br/>
    
      <div class="extra_footer">
        <div>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"></a>
    All content on this site (unless otherwise specified) is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>
</div>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>